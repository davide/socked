<!doctype html>
<html>
<head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <meta HTTP-equiv="X-UA-Compatible" content="IE=EDGE">
    <title>Socked - Mouselive Receiver</title>
    <script type="text/javascript" language="javascript" src="/javascript/sockjs-0.2.min.js"></script>
    <script type="text/javascript" language="javascript" src="/javascript/socked-0.1.js"></script>
</head>
<body>

  <img id="cursor" style="position:absolute;top:-30px;left:-30px;margin-top:-15px;margin-left:-15px" src="Map_pointer.svg" />

  <script type="text/javascript">
    Socked.ready(function(){
      try {
        var host = window.location.host;
        Socked.createConnection({id:'s1', server:host, appKey:'myKey',
            channels: [{name:'mouselive'}]
          });
      } catch(e) {
        console.log('Error setting up connection!');
        return;
      }
    
      var cursor = document.getElementById("cursor");

      var subscriptionOptions = {role: "receiver"};
      var channelRef = Socked.subscribe("s1", "mouselive", subscriptionOptions);
      channelRef.onConnect(function() {
          console.log('connected to mouselive');
  		}).onMessage(function(msg) {
          var mousePosition = JSON.parse(msg);
          var x = mousePosition.shift();
          var y = mousePosition.shift();
          cursor.style.left = x + 'px';
          cursor.style.top = y + 'px';
  		}).onDisconnect(function() {
          console.log('disconnected from mouselive');
  		});
    });
  </script>

</body>
</html>

