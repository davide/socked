<!doctype html>
<html>
<head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <meta HTTP-equiv="X-UA-Compatible" content="IE=EDGE">
    <title>Socked - Connection test</title>
    <script type="text/javascript" language="javascript" src="/javascript/sockjs-0.2.min.js"></script>
    <script type="text/javascript" language="javascript" src="/javascript/socked-0.1.js"></script>
</head>
<body>

<script type="text/javascript">
  Socked.ready(function(){
  	try {
      var host = window.location.host;
      Socked.createConnection({id:'s1', server:host, appKey:'myKey',
          channels: [{name:'batataChannel'}]
        });
    } catch(e) {
      console.log('Error setting up connection: ', e);
      return;
    }
    
    var subscriptionOptions = {
        role: 'both' // | 'sender' | 'receiver',
        // interests: ['chatter']
      };
    var channelRef1 = Socked.subscribe("s1", "batataChannel", subscriptionOptions);
    if (channelRef1 == null) {
      console.log('Channel not found: s1/batataChannel');
      return;
    }
    channelRef1.onConnect(function() {
        console.log('client1 connected to batataChannel');
      }).onMessage(function(msg) {
        console.log('client1 got msg: ', msg);
      }).onDisconnect(function() {
        console.log('client1 disconnected from batataChannel');
      });
      
    var channelRef2 = Socked.subscribe("s1", "batataChannel", subscriptionOptions);
    if (channelRef2 == null) {
      console.log('Channel not found: s1/batataChannel');
      return;
    }
    channelRef2.onConnect(function() {
        console.log('client2 connected to batataChannel');
      }).onMessage(function(msg) {
        console.log('client2 got msg: ', msg);
      }).onDisconnect(function() {
        console.log('client2 disconnected from batataChannel');
      });

    setTimeout(function(){
        channelRef1.send("Hello client2!");
        channelRef2.send("Hello client1!");
      }, 1000);
    setTimeout(function(){
        channelRef1.send("Bye client2!");
        channelRef1.send("Bye client1!");
      }, 3000);
    setTimeout(function(){
        channelRef1.unsubscribe();
        channelRef2.unsubscribe();
      }, 5000);
  });
</script>

</body>
</html>

